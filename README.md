# Telegram Бот Sign up for Classes

Этот Telegram бот помогает студентам быть в курсе расписания занятий в университете, особенно лекций и практических занятий. Он отправляет уведомления о предстоящих занятиях и позволяет студентам записываться на доступные места на практических занятиях.

## Возможности

* Уведомления о лекциях: Получайте автоматические уведомления о предстоящих лекциях.
* Запись на практические занятия: Получайте оповещения об открытии записи на практические занятия и выбирайте свободное место.
* Управление местами: Просматривайте доступные, занятые и выбранные вами места для практических занятий.
* Закрытие сессии: Автоматически закрывает запись на практические занятия по истечении заданного времени (1 час) и подтверждает забронированные места.

## Архитектура проекта

Проект разработан на базе асинхронного фреймворка aiogram для создания Telegram ботов. Его архитектура ориентирована на параллельную обработку задач и эффективное взаимодействие с пользователями.

В основе системы лежит диспетчер (aiogram.Dispatcher), который является центральным узлом для обработки всех входящих обновлений от Telegram. Он получает сообщения и другие события (например, нажатия на инлайн-кнопки) и маршрутизирует их соответствующим обработчикам (handlers).

Обработчики — это асинхронные функции, которые реагируют на определенные действия пользователя или команды. Например, есть обработчик для команды /start, который регистрирует нового пользователя, а также обработчики для коллбэков (нажатий на кнопки), которые управляют процессом записи на практические занятия, подтверждением выбора места или сообщениями о занятых/закрытых слотах.

Ключевым элементом, работающим параллельно с основным циклом обработки обновлений, является фоновая задача schedule_checker. Эта асинхронная корутина непрерывно работает в фоне, периодически (каждые 30 секунд) проверяя текущее время и сравнивая его с записями в заранее определенном full_schedule (полном расписании). Когда наступает время лекции или практики, schedule_checker инициирует отправку соответствующих уведомлений зарегистрированным пользователям. Кроме того, эта задача отвечает за автоматическое закрытие сессий записи на практику по истечении установленного времени (1 час), после чего пользователям, занявшим места, отправляются подтверждающие сообщения.

Для хранения данных в текущей реализации используются переменные в памяти:

* user_ids хранит уникальные идентификаторы всех пользователей, взаимодействовавших с ботом.
* full_schedule содержит статичное, жестко закодированное расписание занятий.
* practice_slots динамически отслеживает активные сессии записи на практические занятия, а также какие места в этих сессиях заняты и каким пользователем.
* sent_notifications используется для предотвращения дублирования уведомлений в течение одного дня.

Важно отметить, что хранение данных в памяти означает, что вся информация о текущих записях на практику будет сброшена при перезапуске бота. Для использования в продакшене потребуется интеграция с постоянной базой данных.

Вспомогательные функции, такие как get_confirm_keyboard и get_slot_keyboard, отвечают за динамическое формирование инлайн-клавиатур, которые предоставляют пользователю интерактивные элементы управления для подтверждения записи и выбора места.

Эта архитектура позволяет боту быть одновременно реактивным (быстро отвечать на действия пользователя) и проактивным (автоматически отправлять уведомления по расписанию), используя асинхронные возможности Python для эффективной работы и обработки множества пользователей.

## Предварительные требования

* Python 3.9+
* Библиотека aiogram (pip install aiogram)

## Использование

* Запустите бота в Telegram: Найдите имя пользователя вашего бота в Telegram и отправьте команду /start.
* Получайте уведомления: Бот будет автоматически отправлять уведомления о лекциях и практических занятиях в соответствии с full_schedule.
* Запишитесь на практику: Когда появится уведомление о практическом занятии, нажмите кнопку "✅ Да", чтобы увидеть доступные места.
* Выберите место: Нажмите на номер свободного места (например, "1", "2"), чтобы забронировать его. Выбранное вами место будет отмечено зеленой галочкой (✅).
* Отменить место: Если вы снова нажмете на свое забронированное место, ваша бронь будет отменена.
* Закрытые сессии: Через 1 час запись на практическое занятие закроется, и вы получите уведомление о подтверждении вашего места.

## Запуск программы 

```
docker build -t my-telegram-bot
```
